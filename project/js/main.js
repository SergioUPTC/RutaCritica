var $activities={},$activitiesLength=0,$starts=[],$ends=[];jQuery(document).ready(function(t){t(".js-resizing").each(function(e,i){t.resizing(t(this))}),t(".popup .popup__close").on("click",function(e){e.preventDefault(),t(this).parents(".popup").removeClass("active"),t(this).find(".association__activities").html("")}),t(".activity__add").on("submit",function(e){e.preventDefault(),$name=t.trim(t("#activity__name").val()),$duration=t.trim(t("#activity__duration").val()),$activities["_"+($activitiesLength+1)]={idActivity:"_"+($activitiesLength+1),name:$name,duration:$duration,associate:[],recorrido:{revisado:!1,acomulado:0,route:""}},$activitiesLength+=1,t.resetForm(t(this)),t.showActivities(),t.calculate_outermost(),t("#activity__name").focus()}),t(document).on("click",".activity__associate",function(e){e.preventDefault(),t.associate__activities(t(this).attr("data-activity__id"))}),t(document).on("submit","#form__association",function(e){e.preventDefault(),$activity=t(this).attr("data-activity"),$activitiesAssc=t(this).serializeArray(),t.each($activitiesAssc,function(e,i){-1==t.inArray($activity,$activities[i.value].associate)&&$activities[i.value].associate.push($activity)}),t.calculate_outermost(),t(this).parents(".popup").find(".popup__close").click()}),t(document).on("click","#calcule__route",function(e){e.preventDefault(),t.calculate_route()})}),$.resizing=function(element){$(window).resize(function(){var width=element.outerWidth();element.css({height:width*eval(element.attr("data-resizing"))}),element.hasClass("panel")&&element.parent().find(".panel").css({height:width*eval(element.attr("data-resizing"))})}).resize()},$.activeLoading=function(){$(".modal__loading").addClass("active")},$.deactiveLoading=function(){$(".modal__loading").removeClass("active")},$.showMessage=function(t,e){e=e||"",$box=$(".message__popup"),$box.find(".message__text").text(t),$box.addClass("active"),setTimeout(function(){$box.removeClass("active"),setTimeout(function(){$box.find(".message__text").text("")},400)},8e3)},$.resetForm=function(t){t[0].reset()},$.showActivities=function(){$listContent=$(".activity__list"),$listContent.html(""),0==$activities.length?$listContent.html('<p class="error">No hay actividades registradas</p>'):($list=$("<tbody>"),$.each($activities,function(t,e){$item=$("<tr>").append($("<td>",{text:e.name})).append($("<td>",{text:e.duration})).append($("<td>").append($("<a>",{text:"Asociar","class":"activity__associate"}).attr("data-activity__id",e.idActivity))),$list.append($item)}),$table=$("<table>").append($("<thead>").append($("<tr>").append($("<th>",{text:"Actividad"})).append($("<th>",{text:"Duraci贸n"})).append($("<th>")))).append($list),$listContent.html($table))},$.associate__activities=function(t){$popup=$("#add_association"),$list=$popup.find(".association__activities"),$list.html(""),$popup.find(".title__desc span").html($activities[t].name),$popup.find("#form__association").attr("data-activity",t),$.each($activities,function(e,i){i.idActivity!=t&&-1==$.inArray(i.idActivity,$activities[t].associate)&&($isCheck=!1,-1!=$.inArray(t,i.associate)&&($isCheck=!0),$list.append($("<div>",{"class":"form__section col-sm-6"}).append($("<label>").append($("<input>").attr({type:"checkbox",name:"activity[]",value:i.idActivity}).prop("checked",$isCheck)).append(i.name))))}),$popup.addClass("active")},$.calculate_outermost=function(){$.calculate_start(),$.calculate_end()},$.calculate_start=function(){$starts=[],$.each($activities,function(t,e){0==e.associate.length&&$starts.push(e)}),$("#starts").html(""),$.each($starts,function(t,e){$("#starts").append($("<span>",{"class":"label",text:e.name}))}),0==$starts.length&&$("#starts").append('<p class="error">No se encontraron actividades donde iniciar</p>')},$.calculate_end=function(){$ends=[],$.each($activities,function(t,e){$isEnd=!0,$.each($activities,function(t,i){e.idActivity!=i.idActivity&&-1!=$.inArray(e.idActivity,i.associate)&&($isEnd=!1)}),$isEnd&&$ends.push(e)}),$("#ends").html(""),$.each($ends,function(t,e){$("#ends").append($("<span>",{"class":"label",text:e.name}))}),0==$ends.length&&$("#ends").append('<p class="error">No se encontraron actividades donde iniciar</p>')},$.calculate_route=function(){$result={ruta:"",valor:null},$("#result__route").text(""),0==$starts.length||0==$ends?$("#result__route").html("No es posible calcular la ruta. No se identifica un inicio o un final del recorrido."):($("#result__route").html("Calculando..."),$result__route={route:"Error en la conexi贸n",acomulado:0},$.ajax({url:"logic/ruta-critica.php",type:"POST",dataType:"json",data:{grafo:JSON.stringify($activities),ends:JSON.stringify($ends),starts:JSON.stringify($starts)}}).done(function(t){console.log(t),$result__route=t,$("#result__route").html($result__route.route).append($("<span>",{"class":"label",text:"Duraci贸n: "+$result__route.acomulado}))}).error(function(){$("#result__route").html($result__route.route).append($("<span>",{"class":"label",text:"Duraci贸n: "+$result__route.acomulado}))}))},$.calculate_route_node=function(t,e,i){return $responseRevisado=!1,$responseAcomulado=0,$responseRouter="",t.recorrido.revisado=!0,$.each(t.associate,function(t,e){e=i[e],$responseRevisado?$responseAcomulado<e.recorrido.acomulado&&($responseRevisado=e.recorrido.revisado,$responseAcomulado=e.recorrido.acomulado,$responseRouter=e.recorrido.route):($responseRevisado=e.recorrido.revisado,$responseAcomulado=e.recorrido.acomulado,$responseRouter=e.recorrido.route)}),$responseRevisado=!0,$responseAcomulado+=parseInt(t.duration),$responseRouter+="-"+t.idActivity,{revisado:$responseRevisado,acomulado:$responseAcomulado,route:$responseRouter}};